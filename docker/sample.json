{
  "$schema": "https://developer.microsoft.com/json-schemas/sp/v2/row-formatting.schema.json",
  "hideSelection": true,
  "hideColumnHeader": true,
  "rowFormatter": {
    "elmType": "div",
    "style": {
      "display": "flex",
      "flex-direction": "row",
      "gap": "4px",
      "border": "1px solid #d0d0d0",
      "border-radius": "4px",
      "min-height": "40px",
      "overflow": "hidden",
      "margin": "2px",
      "align-items": "stretch",
      "box-shadow": "0 2px 8px rgba(0,0,0,0.05)",
      "transition": "all 0.2s ease",
      "flex-wrap": "nowrap"
    },
    "attributes": {
      "class": "ms-depth-8"
    },
    "children": [
      {
        "elmType": "div",
        "style": {
          "display": "flex",
          "flex-direction": "row",
          "align-items": "center",
          "justify-content": "center",
          "gap": "4px",
          "flex-shrink": "0"
        },
        "children": [
          {
            "elmType": "div",
            "style": {
              "display": "flex",
              "gap": "4px",
              "align-items": "center",
              "font-size": "12px",
              "color": "#333",
              "height": "100%",
              "flex-shrink": "0"
            },
            "children": [
              {
                "elmType": "div",
                "style": {
                  "display": "flex",
                  "flex-direction": "column",
                  "align-items": "flex-start",
                  "justify-content": "center",
                  "cursor": "default",
                  "height": "100%",
                  "min-width": "130px",
                  "gap": "2px",
                  "padding": "4px 6px",
                  "white-space": "nowrap",
                  "background-color": "#0f191e",
                  "color": "#ffffff"
                },
                "children": [
                  {
                    "elmType": "span",
                    "txtContent": "=toUpperCase([$tipo_documento])",
                    "style": {
                      "color": "#eee",
                      "font-style": "italic",
                      "font-size": "10px"
                    }
                  },
                  {
                    "elmType": "span",
                    "txtContent": "=toUpperCase([$parent_report_x003a__x0020_Title])",
                    "style": {
                      "font-weight": "700",
                      "font-size": "12px"
                    }
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "elmType": "div",
        "style": {
          "display": "flex",
          "flex-direction": "column",
          "align-items": "center",
          "cursor": "default",
          "gap": "0",
          "flex-shrink": "0",
          "padding": "4px"
        },
        "children": [
          {
            "elmType": "span",
            "style": {
              "display": "inline-block",
              "padding": "4px 8px",
              "background-color": "#0078d4",
              "border-radius": "4px 4px 0 0",
              "font-weight": "700",
              "min-width": "50px",
              "text-align": "center",
              "color": "#ffffff",
              "font-size": "13px",
              "letter-spacing": "0.5px"
            },
            "txtContent": "[$parent_report_x003a__x0020_year]"
          },
          {
            "elmType": "span",
            "style": {
              "display": "inline-block",
              "padding": "3px 8px",
              "background-color": "#f0f0f0",
              "border-radius": "0 0 4px 4px",
              "border": "1px solid #d0d0d0",
              "border-top": "none",
              "font-weight": "600",
              "min-width": "50px",
              "text-align": "center",
              "color": "#555",
              "font-size": "9px",
              "letter-spacing": "0.3px",
              "text-transform": "uppercase"
            },
            "txtContent": "[$parent_report_x003a__x0020_month0]"
          }
        ]
      },
      {
        "elmType": "div",
        "style": {
          "display": "flex",
          "flex-direction": "row",
          "flex-grow": "1",
          "flex-shrink": "1",
          "gap": "4px",
          "justify-content": "space-between",
          "min-width": "0",
          "overflow": "hidden"
        },
        "children": [
          {
            "elmType": "div",
            "style": {
              "font-size": "11px",
              "color": "#000",
              "padding": "4px 6px",
              "white-space": "pre-wrap",
              "word-wrap": "break-word",
              "line-height": "1.2",
              "font-weight": "500",
              "display": "flex",
              "flex-direction": "column",
              "align-items": "start",
              "justify-content": "center",
              "gap": "4px",
              "flex-shrink": "1",
              "min-width": "0"
            },
            "children": [
              {
                "elmType": "span",
                "txtContent": "[$metric_description]",
                "style": {
                  "cursor": "default"
                }
              },
              {
                "elmType": "div",
                "style": {
                  "display": "flex",
                  "flex-direction": "column",
                  "gap": "4px",
                  "align-items": "start"
                },
                "children": [
                  {
                    "elmType": "span",
                    "txtContent": "Valor: ",
                    "style": {
                      "cursor": "default",
                      "font-size": "10px",
                      "color": "#666"
                    }
                  },
                  {
                    "elmType": "div",
                    "inlineEditField": "[$value_manual]",
                    "txtContent": "[$value_final]",
                    "style": {
                      "padding": "3px 6px",
                      "background-color": "#fff",
                      "border": "2px solid #f0eef8",
                      "border-radius": "4px",
                      "cursor": "pointer",
                      "min-width": "50px",
                      "font-weight": "700",
                      "box-shadow": "0 1px 4px rgba(83,45,130,0.08)"
                    },
                    "attributes": {
                      "title": "Haga clic para editar"
                    }
                  },
                  {
                    "elmType": "div",
                    "style": {
                      "display": "flex",
                      "align-items": "center",
                      "gap": "4px",
                      "font-size": "10px",
                      "color": "#666"
                    },
                    "children": [
                      {
                        "elmType": "span",
                        "txtContent": "=if([$tipo_documento] != 'consumo', 'Valor Esperado: ', 'Linea Base: ')"
                      },
                      {
                        "elmType": "span",
                        "txtContent": "=[$value_baseline]",
                        "style": {
                          "font-weight": "700",
                          "color": "#444"
                        }
                      }
                    ]
                  },
                  {
                    "elmType": "div",
                    "style": {
                      "display": "flex",
                      "align-items": "center",
                      "gap": "4px",
                      "font-size": "10px",
                      "color": "#666"
                    },
                    "children": [
                      {
                        "elmType": "span",
                        "txtContent": "=if([$tipo_documento] != 'consumo', 'Valor Minimo: ', 'Delta: ')"
                      },
                      {
                        "elmType": "span",
                        "txtContent": "=if(Number([$value_delta]) > 0, '+', '') + floor(Number([$value_delta]) * 100) / 100",
                        "style": {
                          "font-weight": "700"
                        }
                      }
                    ]
                  }
                ]
              }
            ]
          },
          {
            "elmType": "div",
            "style": {
              "display": "=if([$status] == 'KYD' || [$status] == 'DCO_IBK' || [$status] == 'OWNER_IBK' || [$status] == 'reupload', 'flex', 'none')",
              "flex-direction": "column",
              "gap": "4px",
              "flex-shrink": "0",
              "width": "220px",
              "padding": "4px 6px",
              "justify-content": "center"
            },
            "children": [
              {
                "elmType": "div",
                "style": {
                  "display": "=if(indexOf(join([$aprobador_actual.email], ';'), @me) >= 0, 'flex', 'none')",
                  "align-items": "center",
                  "gap": "4px"
                },
                "children": [
                  {
                    "elmType": "span",
                    "txtContent": "COMENTARIO",
                    "style": {
                      "font-size": "10px",
                      "color": "#666",
                      "font-weight": "600",
                      "letter-spacing": "0.3px"
                    }
                  },
                  {
                    "elmType": "span",
                    "txtContent": "(req. para rechazar):",
                    "style": {
                      "font-size": "8px",
                      "color": "#c74444",
                      "font-style": "italic",
                      "font-weight": "400"
                    }
                  }
                ]
              },
              {
                "elmType": "div",
                "inlineEditField": "[$comentario]",
                "txtContent": "=if([$comentario] && [$comentario] != '', [$comentario], 'Click para agregar comentario...')",
                "style": {
                  "display": "=if(indexOf(join([$aprobador_actual.email], ';'), @me) >= 0, 'block', 'none')",
                  "padding": "4px 8px",
                  "background-color": "#fff",
                  "border": "1.5px solid #d1d1d1",
                  "border-radius": "3px",
                  "cursor": "pointer",
                  "width": "200px",
                  "font-size": "10px",
                  "line-height": "1.3",
                  "color": "=if([$comentario] && [$comentario] != '', '#333', '#999')",
                  "font-style": "=if([$comentario] && [$comentario] != '', 'normal', 'italic')",
                  "box-shadow": "0 1px 3px rgba(0,0,0,0.08)",
                  "white-space": "pre-wrap",
                  "word-wrap": "break-word"
                },
                "attributes": {
                  "title": "Click para editar comentario (requerido para rechazar)"
                }
              },
              {
                "elmType": "div",
                "txtContent": "=if([$comentario] && [$comentario] != '', [$comentario], 'Sin comentarios')",
                "style": {
                  "display": "=if(indexOf(join([$aprobador_actual.email], ';'), @me) >= 0, 'none', 'block')",
                  "padding": "4px 8px",
                  "background-color": "#f5f5f5",
                  "border": "1px solid #e8e8e8",
                  "border-radius": "3px",
                  "cursor": "default",
                  "width": "200px",
                  "font-size": "10px",
                  "line-height": "1.3",
                  "color": "=if([$comentario] && [$comentario] != '', '#333', '#999')",
                  "font-style": "=if([$comentario] && [$comentario] != '', 'normal', 'italic')",
                  "white-space": "pre-wrap",
                  "word-wrap": "break-word"
                },
                "attributes": {
                  "title": "Solo el aprobador puede agregar comentarios"
                }
              }
            ]
          },
          {
            "elmType": "div",
            "style": {
              "display": "=if([$status] == 'DCO_IBK' || [$status] == 'KYD' || [$status] == 'OWNER_IBK', 'flex', 'none')",
              "flex-direction": "column",
              "padding": "2px 4px",
              "font-size": "8px",
              "align-items": "end",
              "justify-content": "center",
              "flex-shrink": "0",
              "min-width": "120px"
            },
            "children": [
              {
                "elmType": "div",
                "style": {
                  "display": "flex",
                  "flex-direction": "column",
                  "gap": "2px",
                  "font-size": "8px",
                  "cursor": "default"
                },
                "children": [
                  {
                    "elmType": "span",
                    "txtContent": "=if([$status] == 'KYD', 'Aprobadores Kyndryl:', if([$status] == 'DCO_IBK', 'Aprobadores Finales IBK DCO:', if([$status] == 'OWNER_IBK', 'Aprobadores Owners IBK:' , 'Aprobadores:')))",
                    "style": {
                      "font-weight": "500",
                      "color": "#666",
                      "font-size": "7px",
                      "text-transform": "uppercase",
                      "letter-spacing": "0.2px"
                    }
                  },
                  {
                    "elmType": "div",
                    "style": {
                      "display": "=if([$status] == 'KYD' && [$aprobador_kyd], 'flex', 'none')",
                      "flex-direction": "column",
                      "gap": "2px"
                    },
                    "forEach": "approver in [$aprobador_kyd]",
                    "children": [
                      {
                        "elmType": "div",
                        "style": {
                          "display": "flex",
                          "align-items": "center",
                          "gap": "2px",
                          "padding": "2px 3px",
                          "background-color": "#f8f8f8",
                          "border-radius": "6px",
                          "border": "1px solid #e8e8e8",
                          "font-size": "8px",
                          "cursor": "pointer",
                          "transition": "all 0.15s ease"
                        },
                        "customCardProps": {
                          "openOnEvent": "hover",
                          "directionalHint": "bottomCenter",
                          "isBeakVisible": true
                        },
                        "children": [
                          {
                            "elmType": "img",
                            "style": {
                              "width": "10px",
                              "height": "10px",
                              "border-radius": "50%",
                              "border": "0.5px solid #ddd"
                            },
                            "attributes": {
                              "src": "=getUserImage([$approver.email],'small')"
                            }
                          },
                          {
                            "elmType": "span",
                            "style": {
                              "font-weight": "500",
                              "color": "#444",
                              "font-size": "7px",
                              "white-space": "nowrap",
                              "overflow": "hidden",
                              "text-overflow": "ellipsis",
                              "max-width": "80px"
                            },
                            "txtContent": "=[$approver.title]"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "elmType": "div",
                    "style": {
                      "display": "=if([$status] == 'OWNER_IBK' && [$aprobador_ing_ibk], 'flex', 'none')",
                      "flex-direction": "column",
                      "gap": "2px"
                    },
                    "forEach": "approver in [$aprobador_ing_ibk]",
                    "children": [
                      {
                        "elmType": "div",
                        "style": {
                          "display": "flex",
                          "align-items": "center",
                          "gap": "2px",
                          "padding": "2px 3px",
                          "background-color": "#f8f8f8",
                          "border-radius": "6px",
                          "border": "1px solid #e8e8e8",
                          "font-size": "8px",
                          "cursor": "pointer",
                          "transition": "all 0.15s ease"
                        },
                        "customCardProps": {
                          "openOnEvent": "hover",
                          "directionalHint": "bottomCenter",
                          "isBeakVisible": true
                        },
                        "children": [
                          {
                            "elmType": "img",
                            "style": {
                              "width": "10px",
                              "height": "10px",
                              "border-radius": "50%",
                              "border": "0.5px solid #ddd"
                            },
                            "attributes": {
                              "src": "=getUserImage([$approver.email],'small')"
                            }
                          },
                          {
                            "elmType": "span",
                            "style": {
                              "font-weight": "500",
                              "color": "#444",
                              "font-size": "7px",
                              "white-space": "nowrap",
                              "overflow": "hidden",
                              "text-overflow": "ellipsis",
                              "max-width": "80px"
                            },
                            "txtContent": "=[$approver.title]"
                          }
                        ]
                      }
                    ]
                  },
                  {
                    "elmType": "div",
                    "style": {
                      "display": "=if([$status] == 'DCO_IBK' && [$aprobador_ibk], 'flex', 'none')",
                      "flex-direction": "column",
                      "gap": "2px"
                    },
                    "forEach": "approver in [$aprobador_ibk]",
                    "children": [
                      {
                        "elmType": "div",
                        "style": {
                          "display": "flex",
                          "align-items": "center",
                          "gap": "2px",
                          "padding": "2px 3px",
                          "background-color": "#f8f8f8",
                          "border-radius": "6px",
                          "border": "1px solid #e8e8e8",
                          "font-size": "8px",
                          "cursor": "pointer",
                          "transition": "all 0.15s ease"
                        },
                        "customCardProps": {
                          "openOnEvent": "hover",
                          "directionalHint": "bottomCenter",
                          "isBeakVisible": true
                        },
                        "children": [
                          {
                            "elmType": "img",
                            "style": {
                              "width": "10px",
                              "height": "10px",
                              "border-radius": "50%",
                              "border": "0.5px solid #ddd"
                            },
                            "attributes": {
                              "src": "=getUserImage([$approver.email],'small')"
                            }
                          },
                          {
                            "elmType": "span",
                            "style": {
                              "font-weight": "500",
                              "color": "#444",
                              "font-size": "7px",
                              "white-space": "nowrap",
                              "overflow": "hidden",
                              "text-overflow": "ellipsis",
                              "max-width": "80px"
                            },
                            "txtContent": "=[$approver.title]"
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      {
        "elmType": "div",
        "style": {
          "display": "flex",
          "flex-direction": "row",
          "align-items": "center",
          "justify-content": "center",
          "border-left": "1px solid #ddd",
          "flex-shrink": "0"
        },
        "children": [
          {
            "elmType": "div",
            "style": {
              "display": "flex",
              "flex-direction": "column",
              "align-items": "center",
              "gap": "2px",
              "padding": "4px"
            },
            "children": [
              {
                "elmType": "a",
                "attributes": {
                  "title": "abrir evidencias",
                  "target": "_blank",
                  "href": "='https://interbankpe.sharepoint.com/sites/PortaldeGobierno-UAT/Lists/REPORTES/Attachments/' + [$parent_report_x003a__x0020_ID] + '/' + [$parent_report_x003a__x0020_uniqu] + '.xlsx?web=1'"
                },
                "style": {
                  "display": "flex",
                  "text-decoration": "none",
                  "flex-direction": "row",
                  "align-items": "center",
                  "cursor": "pointer",
                  "padding": "2px 4px",
                  "color": "#0078d4",
                  "background-color": "#ffffff",
                  "transition": "all 0.12s ease",
                  "border-radius": "4px"
                },
                "children": [
                  {
                    "elmType": "span",
                    "attributes": {
                      "iconName": "OpenInNewWindow"
                    },
                    "style": {
                      "font-size": "12px",
                      "color": "#0078d4",
                      "display": "inline-flex",
                      "align-items": "center",
                      "justify-content": "center",
                      "width": "24px",
                      "height": "24px"
                    }
                  }
                ]
              },
              {
                "elmType": "button",
                "style": {
                  "display": "flex",
                  "text-decoration": "none",
                  "flex-direction": "row",
                  "align-items": "center",
                  "cursor": "pointer",
                  "padding": "2px 4px",
                  "color": "#0078d4",
                  "background-color": "#ffffff",
                  "border": "none",
                  "transition": "all 0.12s ease",
                  "border-radius": "4px"
                },
                "attributes": {
                  "title": "Editar formulario"
                },
                "customRowAction": {
                  "action": "defaultClick"
                },
                "children": [
                  {
                    "elmType": "span",
                    "attributes": {
                      "iconName": "Edit"
                    },
                    "style": {
                      "font-size": "12px",
                      "color": "#0078d4",
                      "display": "inline-flex",
                      "align-items": "center",
                      "justify-content": "center",
                      "width": "24px",
                      "height": "24px"
                    }
                  }
                ]
              }
            ]
          },
          {
            "elmType": "div",
            "style": {
              "display": "=if([$status] == 'CERRADO' || [$status] == 'reupload', 'none', if([$state_broker] == 'idle' && indexOf(join([$aprobador_actual.email], ';'), @me) >= 0, 'flex', 'none'))",
              "flex-direction": "column",
              "gap": "3px",
              "align-items": "center",
              "padding": "4px",
              "height": "100%",
              "flex-shrink": "0",
              "justify-content": "center"
            },
            "children": [
              {
                "elmType": "button",
                "style": {
                  "display": "flex",
                  "align-items": "center",
                  "justify-content": "center",
                  "gap": "3px",
                  "padding": "4px 8px",
                  "border": "none",
                  "border-radius": "4px",
                  "background-color": "#05be50",
                  "color": "#fff",
                  "font-size": "10px",
                  "font-weight": "600",
                  "cursor": "pointer",
                  "transition": "all 0.2s ease",
                  "min-width": "70px"
                },
                "attributes": {
                  "title": "Aprobar"
                },
                "customRowAction": {
                  "action": "setValue",
                  "actionInput": {
                    "state_broker": "aprobar"
                  }
                },
                "children": [
                  {
                    "elmType": "span",
                    "attributes": {
                      "iconName": "CheckMark"
                    },
                    "style": {
                      "font-size": "12px",
                      "padding-right": "2px"
                    }
                  },
                  {
                    "elmType": "span",
                    "txtContent": "Aprobar"
                  }
                ]
              },
              {
                "elmType": "div",
                "style": {
                  "display": "=if([$comentario] == '', 'flex', 'none')",
                  "align-items": "center",
                  "justify-content": "center",
                  "gap": "3px",
                  "padding": "4px 8px",
                  "border": "none",
                  "border-radius": "4px",
                  "background-color": "#c8c6c4",
                  "color": "#fff",
                  "font-size": "10px",
                  "font-weight": "600",
                  "cursor": "not-allowed",
                  "width": "60px",
                  "opacity": "0.6"
                },
                "attributes": {
                  "title": "Debe agregar un comentario antes de rechazar"
                },
                "children": [
                  {
                    "elmType": "span",
                    "attributes": {
                      "iconName": "Cancel"
                    },
                    "style": {
                      "font-size": "12px",
                      "padding-right": "2px"
                    }
                  },
                  {
                    "elmType": "span",
                    "txtContent": "Rechazar"
                  }
                ]
              },
              {
                "elmType": "button",
                "style": {
                  "display": "=if([$comentario] != '', 'flex', 'none')",
                  "align-items": "center",
                  "justify-content": "center",
                  "gap": "3px",
                  "padding": "4px 8px",
                  "border": "none",
                  "border-radius": "4px",
                  "background-color": "#eb0046",
                  "color": "#fff",
                  "font-size": "10px",
                  "font-weight": "600",
                  "cursor": "pointer",
                  "transition": "all 0.2s ease",
                  "min-width": "70px",
                  "opacity": "1",
                  "box-shadow": "0 2px 4px rgba(235, 0, 70, 0.2)"
                },
                "attributes": {
                  "title": "Rechazar"
                },
                "customRowAction": {
                  "action": "setValue",
                  "actionInput": {
                    "state_broker": "rechazar"
                  }
                },
                "children": [
                  {
                    "elmType": "span",
                    "attributes": {
                      "iconName": "Cancel"
                    },
                    "style": {
                      "font-size": "12px",
                      "padding-right": "2px"
                    }
                  },
                  {
                    "elmType": "span",
                    "txtContent": "Rechazar"
                  }
                ]
              }
            ]
          },
          {
            "elmType": "div",
            "style": {
              "display": "=if(([$status] != 'CERRADO' && [$status] != 'reupload') && [$state_broker] == 'idle' && indexOf(join([$aprobador_actual.email], ';'), @me) >= 0, 'none', 'flex')",
              "min-width": "65px",
              "padding": "4px 8px",
              "align-items": "center",
              "justify-content": "center",
              "height": "100%",
              "font-size": "10px",
              "text-overflow": "ellipsis",
              "border-radius": "8px",
              "background-color": "=if([$status] == 'reupload', '#FF462D', if([$status] == 'KYD', '#FF462D', if([$status] == 'DCO_IBK', '#0039a6', if([$status] == 'OWNER_IBK', '#107c10', if([$status] == 'ING_IBK_FINAL', '#008575', if([$status] == 'CERRADO', '#05be50', '#d0d0d0'))))))",
              "font-weight": "800",
              "letter-spacing": "0.8px",
              "text-transform": "uppercase",
              "color": "#fff"
            },
            "txtContent": "=if([$status] == 'reupload', 'Recarga', if([$status] == 'KYD', 'Kyndryl', if([$status] == 'DCO_IBK', 'IBK DCO', if([$status] == 'OWNER_IBK', 'OWNER IBK', if([$status] == 'ING_IBK_FINAL', 'IBK FINAL', if([$status] == 'CERRADO', 'Cerrado', [$status]))))))",
            "attributes": {
              "title": "=if([$status] == 'reupload', 'Documento debe ser cargado nuevamente', if([$status] == 'KYD', 'Esperando aprobaci贸n de Kyndryl', if([$status] == 'DCO_IBK', 'Esperando aprobaci贸n de IBK DCO', if([$status] == 'OWNER_IBK', 'Esperando aprobaci贸n de OWNER IBK', if([$status] == 'ING_IBK_FINAL', 'Esperando aprobaci贸n de IBK FINAL', if([$status] == 'CERRADO', 'Documento cerrado', 'Estado: ' + [$status]))))))"
            }
          }
        ]
      }
    ]
  }
}
