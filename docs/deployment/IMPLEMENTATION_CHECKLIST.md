# OpenClaw Production Deployment - Implementation Checklist

Use this checklist to track your deployment implementation progress.

## ðŸ“‹ Pre-Implementation (Planning)

- [ ] Decide which phase to implement (Phase 1 recommended for first deployment)
- [ ] Identify production server(s) and obtain root/SSH access
- [ ] Verify Docker is installed on production server(s)
- [ ] Have access to GitHub repository (ability to add secrets)
- [ ] Have Claude AI credentials ready (session keys and cookies)
- [ ] Determine network configuration (ports, firewall rules)

## ðŸ”‘ Phase 1: Single Server Deployment

### Step 1: Generate SSH Keys (Local Machine)

- [ ] Run `./scripts/deployment/generate-deploy-keys.sh`
- [ ] Verify private key created: `~/.ssh/openclaw/openclaw_deploy_key`
- [ ] Verify public key created: `~/.ssh/openclaw/openclaw_deploy_key.pub`
- [ ] Securely store private key (will add to GitHub Secrets later)

### Step 2: Setup Production Server

- [ ] Copy setup script to server: `scp scripts/deployment/setup-server.sh root@SERVER_IP:/tmp/`
- [ ] Copy public key to server: `scp ~/.ssh/openclaw/openclaw_deploy_key.pub root@SERVER_IP:/tmp/`
- [ ] SSH to server as root: `ssh root@SERVER_IP`
- [ ] Run setup script: `cd /tmp && chmod +x setup-server.sh && ./setup-server.sh default openclaw_deploy_key.pub`
- [ ] Verify deploy user created: `id deploy`
- [ ] Verify deploy user in docker group: `groups deploy | grep docker`
- [ ] Verify deployment directory exists: `ls -la /home/deploy/openclaw-prd`
- [ ] Verify SSH key added: `su - deploy -c "cat ~/.ssh/authorized_keys"`

### Step 3: Configure Production Environment

- [ ] SSH to server as deploy user: `ssh -i ~/.ssh/openclaw/openclaw_deploy_key deploy@SERVER_IP`
- [ ] Edit .env file: `nano ~/openclaw-prd/.env`
- [ ] Update `CLAUDE_AI_SESSION_KEY` with your key
- [ ] Update `CLAUDE_WEB_SESSION_KEY` with your key
- [ ] Update `CLAUDE_WEB_COOKIE` with your cookie
- [ ] Verify `OPENCLAW_GATEWAY_TOKEN` is set (auto-generated by setup script)
- [ ] Save and exit
- [ ] Verify .env file permissions: `ls -la ~/openclaw-prd/.env` (should be 644)

### Step 4: Copy docker-compose.yml

- [ ] From local machine, copy file: `scp docker-compose.yml deploy@SERVER_IP:~/openclaw-prd/`
- [ ] Verify file copied: `ssh deploy@SERVER_IP "ls -la ~/openclaw-prd/docker-compose.yml"`

### Step 5: Test Manual Deployment

- [ ] SSH to server: `ssh -i ~/.ssh/openclaw/openclaw_deploy_key deploy@SERVER_IP`
- [ ] Navigate to deployment directory: `cd ~/openclaw-prd`
- [ ] Pull images: `docker compose pull`
- [ ] Verify images pulled: `docker images | grep openclaw`
- [ ] Start services: `docker compose up -d`
- [ ] Wait 15 seconds: `sleep 15`
- [ ] Check container status: `docker compose ps` (should show "Up")
- [ ] Test health endpoint: `curl http://localhost:18789/health` (should return 200 OK)
- [ ] Check logs: `docker compose logs openclaw-gateway` (no critical errors)
- [ ] Verify gateway is accessible from outside (if needed): `curl http://SERVER_IP:18789/health`

### Step 6: Configure GitHub Secrets

- [ ] Go to GitHub repository â†’ Settings â†’ Secrets and variables â†’ Actions
- [ ] Click "New repository secret"
- [ ] Add `SSH_PRIVATE_KEY`:
  - Name: `SSH_PRIVATE_KEY`
  - Value: Contents of `~/.ssh/openclaw/openclaw_deploy_key` (entire file including BEGIN/END lines)
  - Copy with: `cat ~/.ssh/openclaw/openclaw_deploy_key`
- [ ] Add `SSH_HOST`:
  - Name: `SSH_HOST`
  - Value: Your server IP (e.g., `100.105.147.99`)
- [ ] Add `SSH_USER`:
  - Name: `SSH_USER`
  - Value: `deploy`
- [ ] Add `SSH_PORT`:
  - Name: `SSH_PORT`
  - Value: `22`
- [ ] Add `DEPLOYMENT_PATH`:
  - Name: `DEPLOYMENT_PATH`
  - Value: `/home/deploy/openclaw-prd`
- [ ] Verify all 5 secrets are added

### Step 7: Verify Workflow Files Exist

- [ ] Check Phase 1 workflow exists: `ls -la .github/workflows/deploy-prd.yml`
- [ ] Check Docker Release workflow exists: `ls -la .github/workflows/docker-release.yml`
- [ ] Review workflow files for correctness

### Step 8: Test Automatic Deployment

- [ ] Checkout PRD branch: `git checkout PRD` (or create: `git checkout -b PRD`)
- [ ] Make empty commit: `git commit --allow-empty -m "test: trigger automatic deployment"`
- [ ] Push to GitHub: `git push origin PRD`
- [ ] Go to GitHub repository â†’ Actions tab
- [ ] Watch "Docker Release" workflow start and complete (~5-10 minutes)
- [ ] Watch "Deploy to Production" workflow start and complete (~2-3 minutes)
- [ ] Check workflow logs for any errors

### Step 9: Verify Automatic Deployment

- [ ] SSH to server: `ssh -i ~/.ssh/openclaw/openclaw_deploy_key deploy@SERVER_IP`
- [ ] Check containers running: `docker compose ps` (should show "Up")
- [ ] Check image version: `docker images | grep openclaw` (should show latest timestamp)
- [ ] Test health endpoint: `curl http://localhost:18789/health` (should return 200 OK)
- [ ] Check logs for new deployment: `docker compose logs --tail=50 openclaw-gateway`

### Step 10: Document and Finalize

- [ ] Document server IP, credentials location, and access procedures
- [ ] Share deployment documentation with team (if applicable)
- [ ] Set up monitoring/alerting (optional)
- [ ] Schedule regular maintenance windows

## ðŸ”§ Optional Enhancements

### Backup Setup

- [ ] Copy backup script to server: `scp scripts/deployment/backup-openclaw.sh deploy@SERVER_IP:~/`
- [ ] Make executable: `ssh deploy@SERVER_IP 'chmod +x ~/backup-openclaw.sh'`
- [ ] Test backup: `ssh deploy@SERVER_IP '~/backup-openclaw.sh'`
- [ ] Verify backup created: `ssh deploy@SERVER_IP 'ls -la /var/backups/openclaw/'`
- [ ] Add to crontab: `ssh deploy@SERVER_IP 'crontab -e'`
- [ ] Add line: `0 2 * * * /home/deploy/backup-openclaw.sh`
- [ ] Verify crontab: `ssh deploy@SERVER_IP 'crontab -l'`

### Security Hardening

- [ ] SSH to server as root: `ssh root@SERVER_IP`
- [ ] Disable password auth for deploy user:
  ```bash
  cat >> /etc/ssh/sshd_config <<EOF

  # Deploy user hardening
  Match User deploy
      PasswordAuthentication no
      PubkeyAuthentication yes
  EOF
  ```
- [ ] Restart SSH: `systemctl restart sshd`
- [ ] Test SSH key access still works: `ssh -i ~/.ssh/openclaw/openclaw_deploy_key deploy@SERVER_IP`
- [ ] Configure firewall (if using UFW):
  ```bash
  ufw allow 22/tcp      # SSH
  ufw allow 18789/tcp   # OpenClaw Gateway
  ufw allow 18790/tcp   # OpenClaw Bridge
  ufw enable
  ```
- [ ] Verify firewall rules: `ufw status`

## ðŸ“ˆ Phase 2: Multi-Server Deployment (Optional)

### Prerequisites

- [ ] Phase 1 successfully implemented and tested
- [ ] Need to deploy to 2+ servers
- [ ] All servers prepared using `setup-server.sh`

### Implementation

- [ ] Run `setup-server.sh` on all additional servers
- [ ] Configure `.env` files on all servers with tenant-specific credentials
- [ ] Copy `docker-compose.yml` to all servers
- [ ] Test manual deployment on each server
- [ ] Disable Phase 1 workflow: `mv .github/workflows/deploy-prd.yml .github/workflows/deploy-prd-single.yml.disabled`
- [ ] Enable Phase 2 workflow: `mv .github/workflows/deploy-prd-multi.yml .github/workflows/deploy-prd.yml`
- [ ] Update `.github/servers/production.json` with all server entries
- [ ] Commit and push: `git add .github && git commit -m "feat: enable multi-server deployment" && git push origin PRD`
- [ ] Watch deployment workflow deploy to all servers
- [ ] Verify deployment on each server
- [ ] Test health endpoints on all servers

## ðŸŽ¯ Phase 3: Kubernetes (Long-term)

- [ ] Determine if K8s is needed (20+ servers, auto-scaling required)
- [ ] Choose K8s provider (GKE, EKS, AKS, DigitalOcean, self-managed)
- [ ] Provision K8s cluster
- [ ] Create namespace-per-tenant manifests
- [ ] Setup Horizontal Pod Autoscaler (HPA)
- [ ] Configure Ingress Controller
- [ ] Setup GitOps (Flux or ArgoCD)
- [ ] Migrate from Phase 2 to K8s
- [ ] Test auto-scaling behavior
- [ ] Document K8s-specific procedures

## âœ… Post-Implementation

### Documentation

- [ ] Update internal documentation with:
  - Server IPs and hostnames
  - Access procedures
  - Deployment process
  - Emergency contacts
  - Rollback procedures
- [ ] Share with team members

### Monitoring

- [ ] Setup health check monitoring (e.g., UptimeRobot, Pingdom)
- [ ] Configure alerting (email, Slack, Discord)
- [ ] Setup log aggregation (optional)
- [ ] Document monitoring procedures

### Testing

- [ ] Test rollback procedure manually (optional but recommended)
- [ ] Test deployment failure scenario
- [ ] Test automatic rollback on health check failure
- [ ] Document test results

### Maintenance Schedule

- [ ] Add calendar reminders for:
  - [ ] Daily: Check GitHub Actions for failures
  - [ ] Weekly: Review logs and disk usage
  - [ ] Monthly: Prune unused images, rotate gateway tokens
  - [ ] Quarterly: Rotate SSH keys, update secrets

## ðŸ†˜ Troubleshooting Checklist

If something goes wrong, check:

- [ ] GitHub Actions logs (detailed error messages)
- [ ] Server logs: `ssh deploy@SERVER_IP "docker compose logs"`
- [ ] Container status: `ssh deploy@SERVER_IP "docker compose ps"`
- [ ] Health endpoint: `curl http://SERVER_IP:18789/health`
- [ ] Disk space: `ssh deploy@SERVER_IP "df -h"`
- [ ] Docker service: `ssh deploy@SERVER_IP "sudo systemctl status docker"`
- [ ] SSH key permissions: `ls -la ~/.ssh/openclaw/`
- [ ] GitHub Secrets configured correctly
- [ ] .env file has correct credentials
- [ ] Firewall rules allow required ports

## ðŸ“Š Success Criteria

Your deployment is successful when:

- [x] âœ… All checklist items above are completed
- [x] âœ… Push to PRD branch triggers automatic deployment
- [x] âœ… Deployment completes without errors
- [x] âœ… Health checks pass
- [x] âœ… Containers are running on server
- [x] âœ… Gateway is accessible
- [x] âœ… Logs show no critical errors
- [x] âœ… You can trigger deployments without manual SSH
- [x] âœ… Automatic rollback works (if tested)

## ðŸ“ Notes

Use this space for deployment-specific notes:

```
Server IP: _________________
Deployment Date: _________________
Phase Implemented: [ ] 1  [ ] 2  [ ] 3
Issues Encountered: _________________
Resolutions: _________________
Team Members Involved: _________________
```

---

**Congratulations!** ðŸŽ‰

Once all items are checked, you have successfully implemented automatic production deployment for OpenClaw!
